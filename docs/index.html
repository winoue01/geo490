#Introduction

The wildfire is one of the major concerns in the States. It not only threatens people's lives but also impacts the ecosystem of the area. To raise the awareness of the dangers of wildfires, for this project, data analysis was conducted with R.


#1. Download the Data
The data is retrieved from the class file using NetCDF.NetCDF is a widely used format for exchanging or distributing climate data, and has also been adopted in other fields. Wildfire is not climate data; however, the data contains the spatial data such as location and other information regarding damages caused. The file downloaded is called nc_files from GEO490 server contains following:

* TraCE_tas_llsy_monlenadj_seas_anm_PI_hw30.nc
* TraCE_tas_llsy_monlenadj_seas_locanm_hw30.nc
* treecov.nc
* tsi_v02r01_monthly_s188201_e188212_c20170717.nc
* us_fires.nc

#2.1 Open File#
To open the ncfiles on RStudio, the package **ncdf4** needs to be installed. The following code does not contain the installation part because the installation is required only once.  

    library(ncdf4)
	ncpath <- "/Users/wauno/Documents/GEO 490/nc_files/"
	ncname <- "us_fires"
	ncfname <- paste(ncpath, ncname, ".nc", sep="")

	
	ncin <- nc_open(ncfname)
	print(ncin)

#2.2 Get the longitude and latitude#
    
	lon <- ncvar_get(ncin,"lon")
	nlon <- dim(lon)
	head(lon)
	lat <- ncvar_get(ncin,"lat")
	nlat <- dim(lat)
	head(lat)
	print(c(nlon,nlat))
#2.3 Get Fire Data#
	dname <- "fpafod_counts"
	dname2 <- "fpafod_mean_area"
	fire_array <- ncvar_get(ncin, dname)
	fire_area_array <- ncvar_get(ncin, dname2)
	dlname <- ncatt_get(ncin, dname, "long_name")
	dunits <- ncatt_get(ncin, dname, "units")
	fillvalue <- ncatt_get(ncin,dname,"_FillValue")
	dim(fire_array)
#2.4 Get global attributes#
	title <- ncatt_get(ncin,0,"title")
	institution <- ncatt_get(ncin,0,"institution")
	datasource <- ncatt_get(ncin,0,"datasource")
	references <- ncatt_get(ncin,0,"references")
	history <- ncatt_get(ncin,0,"history")
	Conventions <- ncatt_get(ncin,0,"Conventions")
#2.5 Basic Visualization#
To visualize the data, some packages need to be installed beforehand. For this project, packages **RColorBrewer** was installed, for instance.

	fire_array[fire_array==fillvalue$value] <- NA
	length(na.omit(as.vector(fire_array[,1])))


	grid <- expand.grid(lon=lon, lat=lat)
	cutpts <- c(0,50,100,150,200,250,300,350,400,500)
	levelplot(fire_area_array ~ lon * lat, data=grid, at=cutpts, cuts=11, pretty=T, 
          col.regions=(rev(brewer.pal(10,"RdBu"))))
![](https://i.imgur.com/8iYKeAC.png)
It is a rough image since base map (U.S. shapefile is not used, but we can still observe that which area has higher occurrence of wildfires.)
![](https://i.imgur.com/NSBBpi7.png)

This is for the the average area.

#2.6 Plotting the U.S. shpafile #
Since the visuzlizetion process was conducted without the shapefile (the U.S. boundary without Alaska and Hawaii), to improve the visualization, the U.S. boundary shapefile was downloaded from:
[https://www.weather.gov/gis/USStates 
](https://www.weather.gov/gis/USStates)

	shp_path <- "/Users/wauno/Documents/GEO 490/nc_files/s_11au16/"
	shp_name <- "s_11au16.shp"
	shp_file <- paste(shp_path, shp_name, sep="")

	us_shp <- read_sf(shp_file)
	us_outline <- as(st_geometry(us_shp), Class="Spatial")
	us_outline_gg <- fortify(us_outline)


	ggplot(us_outline_gg, aes(long, lat)) + geom_polygon(aes(group = group), color = "gray50", fill = NA) +
    theme_bw() + xlim(-130, -68) + ylim(20,50)

![](https://i.imgur.com/hHwx3tn.png)

#2.7 Plotting raster data of wildfire frequency#
The data is plotted by using **levelplot()**. To use this feature, **raterVis** package needs to be installed beforehand. This package implements a bumber of Lattice-type plots for raster data set. 

    fire_path <- "/Users/wauno/Documents/GEO 490/nc_files/"
	fire_name <- "us_fires.nc"
	fire_file <- paste(fire_path, fire_name, sep="")
	fire <- raster(fire_file)
	print(fire)


> File C:\Users\wauno\Documents\GEO 490\nc_files\us_fires.nc (NC_FORMAT_NETCDF4):

>2 variables (excluding dimension variables):
 >float fpafod_counts[lon,lat]   (Contiguous storage)  
 units: 1
            _FillValue: 1.00000003318135e+32
            long_name: Number of fires, 1992-2013
        >float fpafod_mean_area[lon,lat]   (Contiguous storage)  
            units: ha
            _FillValue: 1.00000003318135e+32
            long_name: Average Fire Size, 1992-2013

   >2 dimensions:
        lon  Size:126
            units: degrees_east
            long_name: lon
            axis: X
        lat  Size:50
            units: degrees_north
            long_name: lat
            axis: Y

   >7 global attributes:
        _NCProperties: version=1|netcdflibversion=4.4.1.1|hdf5libversion=1.10.0
        title: FPA-FOD Fires
        institution: USFS
        source: http://www.fs.usda.gov/rds/archive/Product/RDS-2013-0009.3/
        references: Short, K.C., 2014, Earth Syst. Sci. Data, 6, 1-27
        history: P.J. Bartlein, Sat May  4 16:31:03 2019
        Conventions: CF-1.6

	fire
>class      : RasterLayer 
dimensions : 50, 126, 6300  (nrow, ncol, ncell)
resolution : 0.5, 0.5  (x, y)
extent     : -128, -65, 25.5, 50.5  (xmin, xmax, ymin, ymax)
crs        : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0 
source     : C:/Users/wauno/Documents/GEO 490/nc_files/us_fires.nc 
names      : Number.of.fires..1992.2013 
zvar       : fpafod_counts 


	print(c(filename(fire), hasValues(fire), inMemory(fire)))
>[1] "C:\\Users\\wauno\\Documents\\GEO 490\\nc_files\\us_fires.nc"
[2] "TRUE"                                                       
[3] "FALSE"
 
	levelplot(fire)

![](https://i.imgur.com/alWvodj.png)

#2.8 Plotting with shapefile
Finally, the wildfire occurrence data is plotted on the U.S. boundary shapefile with a graduated color.
	
	mapTheme <- rasterTheme(region=brewer.pal(9,"Greens"))
	plt <- levelplot(fire, margin=F, par.settings=mapTheme)
	plt + latticeExtra::layer(sp.lines(us_outline, col="gray30", lwd=0.5))
![](https://i.imgur.com/2O2SHAQ.png)





    
